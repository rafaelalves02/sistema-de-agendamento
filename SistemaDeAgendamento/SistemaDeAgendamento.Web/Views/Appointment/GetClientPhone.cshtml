@model SistemaDeAgendamento.Web.Models.Appointment.ReadViewModel;

@{
    ViewBag.Title = "Consultar Agendamentos";
}

<div class="container mt-5 d-flex justify-content-center">
    <div class="card shadow-lg border-0" style="max-width: 450px; width: 100%;">
        <div class="card-body p-4 text-center">
            <h4 class="card-title mb-4 text-primary fw-bold">
                Consultar Agendamentos
            </h4>

            <form asp-controller="Appointment" asp-action="Read" id="form" class="needs-validation" novalidate>
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="inputPhoneNumber"
                           asp-for="ClientPhoneNumber" placeholder="(61) 9 9999-9999" required>
                    <label for="inputPhoneNumber">Telefone (Whatsapp)</label>
                    <div class="invalid-feedback text-start">
                        Por favor, informe o número de telefone.
                    </div>
                </div>

                <button type="submit" class="btn btn-primary w-100 py-2">
                    Ver meus agendamentos
                </button>
            </form>

        </div>
    </div>
</div>

@section Scripts {
    <script>
        (() => {
            'use strict';

            const forms = document.querySelectorAll('.needs-validation');
            Array.from(forms).forEach(form => {
                form.addEventListener('submit', event => {

                    const phoneInput = document.getElementById('inputPhoneNumber');
                    const phoneDigits = phoneInput.value.replace(/\D/g, '');
                    const isValidPhone = phoneDigits.length === 11;

                    if (!isValidPhone) {
                        phoneInput.classList.add('is-invalid');
                        event.preventDefault();
                        event.stopPropagation();
                        closeModal();
                    } else {
                        phoneInput.classList.remove('is-invalid');
                    }

                    if (!form.checkValidity()) {
                        event.preventDefault();
                        event.stopPropagation();
                    }
                    form.classList.add('was-validated');
                }, false);
            });
        })();

        const phoneInput = document.getElementById('inputPhoneNumber');
        phoneInput.addEventListener('input', function (e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) value = value.slice(0, 11);

            if (value.length > 2 && value.length <= 7) {
                value = `(${value.slice(0, 2)}) ${value.slice(2)}`;
            } else if (value.length > 7 && value.length <= 11) {
                value = `(${value.slice(0, 2)}) ${value.slice(2, 3)} ${value.slice(3, 7)}-${value.slice(7)}`;
            } else if (value.length > 0 && value.length <= 2) {
                value = `(${value}`;
            }

            e.target.value = value;
        });

        const form = document.querySelector('form');
        form.addEventListener('submit', function () {
            const input = document.getElementById('inputPhoneNumber');
            input.value = input.value.replace(/\D/g, '');
        });
    </script>
}
